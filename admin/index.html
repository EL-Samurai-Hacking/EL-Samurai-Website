<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة تحكم متطورة - EL Samurai</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #111;
      color: white;
      padding: 20px;
    }
    h1 {
      color: #0ff;
    }
    label {
      display: block;
      margin: 10px 0 5px;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    button {
      background-color: #0ff;
      color: #000;
      font-weight: bold;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    .preview {
      margin-top: 30px;
    }
    .card {
      background: #222;
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 15px;
      position: relative;
    }
    .card img {
      width: 100%;
      border-radius: 10px;
      max-height: 180px;
      object-fit: cover;
    }
    .delete, .edit {
      position: absolute;
      top: 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      padding: 5px 10px;
      color: white;
    }
    .delete {
      left: 10px;
      background: red;
    }
    .edit {
      left: 80px;
      background: orange;
    }
    .attachment {
      margin-top: 10px;
      display: block;
      color: #0ff;
    }
  </style>
</head>
<body><h1>🛠️ لوحة التحكم: إضافة / تعديل خدمة</h1><form id="addServiceForm">
  <input type="hidden" id="editIndex"><label>📌 العنوان</label> <input type="text" id="title" required>

<label>🖼️ رابط الصورة أو ارفعها</label> <input type="url" id="imageUrl" placeholder="https://example.com/image.jpg"> <input type="file" id="imageFile" accept="image/*">

<label>📝 الوصف</label>

  <textarea id="desc" rows="3" required></textarea><label>📂 الفئة</label> <select id="category"> <option value="أدوات">أدوات</option> <option value="كورسات">كورسات</option> <option value="أخبار">أخبار</option> <option value="أخرى">أخرى</option> </select>

<label>🔗 رابط خارجي</label> <input type="url" id="link" placeholder="https://t.me/..." required>

<label>📎 ملف مرفق (رابط تحميل أو ملف)</label> <input type="url" id="fileUrl" placeholder="https://example.com/file.zip"> <input type="file" id="fileUpload">

<button type="submit">💾 حفظ الخدمة</button>

</form><div class="preview" id="preview"></div><script>
  const form = document.getElementById('addServiceForm');
  const preview = document.getElementById('preview');
  const editIndexInput = document.getElementById('editIndex');
  let services = JSON.parse(localStorage.getItem('services') || '[]');

  function renderServices() {
    preview.innerHTML = '';
    services.forEach((s, index) => {
      preview.innerHTML += `
        <div class="card">
          <button class="delete" onclick="deleteService(${index})">حذف</button>
          <button class="edit" onclick="editService(${index})">تعديل</button>
          <img src="${s.image}" alt="${s.title}">
          <h3>${s.title}</h3>
          <p>${s.desc}</p>
          <p><strong>الفئة:</strong> ${s.category}</p>
          <a href="${s.link}" target="_blank" style="color:#0ff;">رابط الخدمة</a>
          ${s.file ? `<a class="attachment" href="${s.file}" target="_blank">📎 تحميل المرفق</a>` : ''}
        </div>
      `;
    });
  }

  function deleteService(index) {
    if (confirm("هل أنت متأكد من حذف هذه الخدمة؟")) {
      services.splice(index, 1);
      localStorage.setItem('services', JSON.stringify(services));
      renderServices();
    }
  }

  function editService(index) {
    const s = services[index];
    document.getElementById('editIndex').value = index;
    document.getElementById('title').value = s.title;
    document.getElementById('imageUrl').value = s.image.startsWith('data:') ? '' : s.image;
    document.getElementById('desc').value = s.desc;
    document.getElementById('category').value = s.category;
    document.getElementById('link').value = s.link;
    document.getElementById('fileUrl').value = s.file && !s.file.startsWith('data:') ? s.file : '';
    window.scrollTo(0, 0);
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    let image = document.getElementById('imageUrl').value;
    const imageFile = document.getElementById('imageFile').files[0];
    if (imageFile) image = await readFile(imageFile);

    let file = document.getElementById('fileUrl').value;
    const fileBlob = document.getElementById('fileUpload').files[0];
    if (fileBlob) file = await readFile(fileBlob);

    const newService = {
      title: title.value,
      image: image,
      desc: desc.value,
      category: category.value,
      link: link.value,
      file: file
    };

    const editIndex = editIndexInput.value;
    if (editIndex !== '') {
      services[editIndex] = newService;
      editIndexInput.value = '';
    } else {
      services.push(newService);
    }

    localStorage.setItem('services', JSON.stringify(services));
    form.reset();
    renderServices();
  });

  function readFile(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  renderServices();
</script></body>
</html>